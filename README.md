#ジョット
Djot は軽量のマークアップ構文です。この機能のほとんどはcommonmarkから派生していますが、 commonmark の構文が複雑で効率的な解析が困難になっているいくつかの問題が修正されています。また、commonmark よりも機能がはるかに充実しており、定義リスト、脚注、表、いくつかの新しい種類のインライン書式設定 (挿入、削除、ハイライト、上付き文字、下付き文字)、数学、スマート句読点、あらゆるものに適用できる属性がサポートされています。要素、およびブロックレベル、インラインレベル、生のコンテンツ用の汎用コンテナー。

このプロジェクトは、私がエッセイ「Beyond Markdown」で提案したアイデアのいくつかを実装する試みとして始まりました。(以下の「理論的根拠」を参照してください。)

このリポジトリには、 構文の説明、チートシート、および djot と Markdown の主な違いの概要を説明するMarkdown ユーザー向けのクイック スタートが含まれています 。

ローカルに何もインストールしなくても、 djot プレイグラウンドで djot を試すことができます 。

理論的根拠
設計目標は次のとおりです。

djot マークアップはバックトラッキングなしで線形時間で解析できる必要があります。

インライン要素の解析は「ローカル」である必要があり、後で定義される参照に依存しません。これは commonmark には当てはまりません。 [foo][bar]「[foo]」の後にテキスト「bar」を含むリンク、または「[foo][bar]」、またはテキスト「foo」を含むリンク、またはテキスト「」を含むリンクが続く場合があります。 foo" の後に "[bar]" が続きます。これは、参照[foo]と が [bar]ドキュメント内の別の場所 (おそらく後で) で定義されているかどうかに応じて異なります。この非局所性により、正確な構文の強調表示はほぼ不可能になります。

強調のルールはもっとシンプルであるべきです。コモンマークでは二重文字が強い強調に使用されているため、多くの潜在的な曖昧さが生じますが、これらは 17 個のルールの気の遠くなるようなリストによって解決されます。これらのルールの優れたメンタルモデルを形成するのは困難です。ほとんどの場合、彼らは人間が最も自然に解釈する方法で物事を解釈しますが、常にそうとは限りません。

表現上の盲点は避けるべきです。a<em>?</em>bcommonmark では、フランキング ルールによって最初のアスタリスクがa*?*b右フランキングとして分類されるため、 HTML を生成する場合は運が悪いです 。これを回避する方法はありますが、醜いです ( の代わりに数値エンティティを使用しますa)。djot では、この種の表現上の死角があってはなりません。

どのコンテンツがリスト項目に属するかのルールは単純である必要があります。commonmark では、リスト項目の下のコンテンツは、リスト マーカーの後の最初のスペース以外のコンテンツまでインデントする必要があります (リスト項目がインデントされたコードで始まる場合は、マーカーの後ろに 5 つのスペース)。インデントされたコンテンツが十分にインデントされておらず、リスト項目に含まれない場合、多くの人が混乱します。

パーサーは、Unicode 文字クラス、HTML タグ、またはエンティティを認識したり、Unicode の大文字と小文字の折りたたみを実行したりすることを強制されるべきではありません。これにより、さらに複雑さが増します。

構文はハードラップに適している必要があります。段落をハードラップすることにより、異なる解釈が生じてはなりません (たとえば、ピリオドが続く数字が行頭になる場合など)。(多くの人が、なぜハードラップするのか疑問に思うと思います。答え: HTML への変換や、長い行をソフトラップする特別なエディター モードを使用せずに、文書をそのまま読めるようにするためです。ソースの可読性は 1 つであったことを思い出してください。 Markdown と Commonmark の主な目的の一部です。)

構文は次の意味で均一に構成されている必要があります。つまり、一連の行がリスト項目またはブロック引用符の外側で特定の意味を持つ場合、その内側でも同じ意味を持つ必要があります。この原則はcommonmark spec で明確に示されていますが、この仕様は完全に準拠しているわけではありません ( commonmark/commonmark-spec#634を参照)。

任意の属性を任意の要素に付加できる必要があります。

テキスト、インライン コンテンツ、およびブロック レベルのコンテンツには、任意の属性を適用できる汎用コンテナーが必要です。これにより、AST 変換を使用した拡張性が可能になります。

これらの目標に合わせて、構文は可能な限り単純にする必要があります。したがって、たとえば、2 つの異なるスタイルの見出しやコード ブロックは必要ありません。

これらの目標が次の決定の動機となりました。

目標 7 のため、ブロック レベルの要素は段落 (または見出し) を中断することはできません。したがって、djot では、以下は 1 つの段落であり、(commonmark が考えるように) 段落の後に順序付きリストが続き、その後にブロック引用符が続くというものではありません。セクションの見出し:

My favorite number is probably the number
1. It's the smallest natural number that is
> 0. With pencils, though, I prefer a
# 2.
Commonmark は、段落を中断する以外のマーカーで始まるリストを禁止することで、目標 7 に対してある程度の譲歩をしています1.。しかし、これは構文の規則性と予測可能性を犠牲にした妥協です。一般的なルールを決めたほうが良いでしょう。

- 最後の決定の意味するところは、「タイトな」リストはまだ可能だが（項目間に空行がない）、サブリストの前には常に空行を置かなければならないということです。したがって、

```
- Fruits
  - apple
  - orange
```
は以下のように書かなければなりません。

```
- Fruits

  - apple
  - orange
```

(この空行は「タイトさ」にはカウントされません)。reStructuredTextも同じ設計上の決定を行います。

また、目標7を促進するために、見出しが複数行にわたる「怠惰さ」を許可します。

```
## My excessively long section heading is too
long to fit on one line.
```

作業中に、setext-style(下線付き)の見出しを削除して簡素化します。実際には2つの見出し構文は必要ありません(目標11)。

- 目標5を達成するために、非常に単純なルールがあります。リスト マーカーの先頭を超えてインデントされているものはすべてリスト項目に属します。

```
1. list item

  > block quote inside item 1

2. second item
```

commonmarkでは、ブロック引用符が十分にインデントされていないため、これはブロック引用符で囲まれた2つの別個のリストとして解析されます。commonmarkでこの単純なルールを使用できなかったのは、インデントされたコード ブロックでした。リスト項目にインデントされたコード ブロックが含まれる場合、どの列でインデントのカウントを開始するかを知る必要があるため、リストの見栄えを最も良くする列(マーカーの後のスペース以外のコンテンツの最初の列)に固定しました。

```
1.  A commonmark list item with an indented code block in it.

        code!
```

djot では、インデントされたコード ブロックを削除するだけです。いずれにせよ、ほとんどの人はフェンスで囲まれたコード ブロックを好みます。コード ブロックを記述する2つの異なる方法は必要ありません(目標11)。

- 目標6を達成し、生のHTMLを処理するために採用されている複雑なルールを回避するために、明示的にマークされたコンテキストを除き、生のHTMLを許可しません

例: `<a id="foo">`{=html}

``` =html
<table>
<tr><td>foo</td></tr>
</table>
```

Markdownとは異なり、djotはHTML中心ではありません。Djotドキュメントはさまざまな形式でレンダリングされる可能性があるため、生のコンテンツをあらゆる出力形式に含める柔軟性を提供したいと考えていますが、HTMLに特権を与える理由はありません。同様の理由で、commonmarkとは異なり、HTMLエンティティを解釈しません。

- 目標2を達成するために、参照リンクの解析をローカルにします。`[foo][bar]`または`[foo][]`のように見えるものは、`[foo]`が文書の後半で定義されているかどうかに関係なく、参照リンクとして扱われます。したがって、`[like this]`のような括弧1つだけのショートカット リンク構文は削除しなければなりません。周囲の文脈を知らなくても何がリンクであるかは常に明確でなければなりません。

- 目標6をサポートするため、参照リンクでは大文字と小文字が区別されなくなりました。ASCIIコンテキストを超えてこれをサポートするには、すべての実装にUnicodeケースの折りたたみを組み込む必要がありますが、その必要はないようです。

- 目標8に記載されている均一性の原則の違反を避けるために、ブロック引用符の後にスペースまたは改行が必要です。

```
>This is not a
>block quote in djot.
```

- 目標3を達成するために、強調のために二重文字を使用することは避けます。代わりに`_`強調や`*`強い強調を使用します。強調は後にスペースが続かない限り、これらの文字1つで開始でき、前にスペースがなく、間に異なる文字が存在しない限り、類似の文字が見つかったときに終了します。重複した場合は、最初に閉じられたものが優先されます。(この単純なルールにより、commonmarkでUnicode文字クラスを決定する必要性も回避できます -- 目標6)。

- この最後の変更だけを見ても、表現上の盲点が多数発生することになります。たとえば単純なルールを考えると、

```
_(_foo_)_
```

は以下のように解析します

```
<em>(</em>foo<em>)</em>
```

それよりも

```
<em>(<em>foo</em>)</em>
```

後者の解釈が必要な場合、djotでは次の構文を使用できます。

```
_({_foo_})_
```

`{_`は強調を開くだけの`_`であり、`_}`は強調を閉じるだけの`_`です。同じことが`*`やオープナー、クローザー間があいまいなその他インライン書式設定マーカーでも同じです。これらの中括弧は、特定のインライン・マークアップ、例えば`{=highlighting=}`、`{+insert+}`、`{-delete-}`に必要です。

- 目標1をサポートするために、コード スパン解析はバックトラックしません。したがって、コード スパンを開いて閉じないと、段落の終わりまで拡張されます。これは、commonmarkでフェンスド コード ブロックが動作する方法と似ています。

```
This is `inline code.
``

- 目標9をサポートするために汎用属性構文が導入されています。属性はその前の行に配置することで任意のブロック レベルの要素に付加でき、その直後に配置することで任意のインライン レベルの要素に付加できます。

```
{#introduction}
This is the introductory paragraph, with
an identifier `introduction`.

           {.important color="blue" #heading}
## heading

The word *atelier*{weight="600"} is French.
```

- 汎用属性を使用する予定であるため、リンク内での引用タイトルはサポートされなくなりました。必要に応じて`title`属性を追加できますが、これはあまり一般的ではないため特別な構文は必要ありません。

```
[Link text](url){title="Click me!"}
```

- ブロックレベルまたはインラインレベルの要素の任意のシーケンスに属性を付加できるようにするためフェンスで囲まれたdivと括弧で囲まれたスパンが導入されました。例えば、

```
{#warning .sidebar}
::: Warning
This is a warning.
Here is a word in [français]{lang=fr}.
:::
```

## 構文

完全な構文リファレンスについては、「[構文の説明](https://htmlpreview.github.io/?https://github.com/jgm/djot/blob/master/doc/syntax.html)」を参照してください。

djotのvim構文強調表示定義は、`editors/vim/`で提供されています。

## 実装

現在、6つのdjot実装があります。

- [djot.js (JavaScript/TypeScript)](https://github.com/jgm/djot.js)
- [djot.lua (Lua)](https://github.com/jgm/djot.lua)
- [djota (Prolog)](https://github.com/aarroyoc/djota)
- [jotdown (Rust)](https://github.com/hellux/jotdown)
- [godjot (Go)](https://github.com/sivukhin/godjot)
- [djoths (Haskell)](https://github.com/jgm/djoths)

`djot.lua`はオリジナルのリファレンス実装でしたが、現在の開発は`djot.js`に重点を置いており、`djot.lua`が最新の構文変更に対応していない可能性があります。

## ファイル拡張子

拡張子は、`.dj`ファイルの内容がdjot形式のテキストであることを示すために使用できます。

## ライセンス

コードとドキュメントはMITライセンスに基づいてリリースされています。